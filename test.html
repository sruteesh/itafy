<html>
<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.6.0/mapbox.css' rel='stylesheet' />
    <script src='http://api.tiles.mapbox.com/mapbox.js/v1.6.0/mapbox.js'></script>
    <script src='http://code.jquery.com/jquery-2.0.3.min.js'></script>

    <style type="text/css">
        #body {
            margin: 0;
            padding: 0;
        }
        #map {
            position:absolute;
            width:100%;
            height:100%;
            margin-left: 300px;
        }
        #tweets-feed {
            position: absolute;
            width: 300px;
            left: 0px;
            bottom: 0px;
            overflow: scroll;
        }
    </style>
</head>
<body>
    <div id='tweets-feed'></div>
    <div id='map'></div>

    <script>
        window.supermap = L.mapbox.map('map', 'raulmarcosl.h2di3h3g');
        window.supermap.addControl(L.mapbox.geocoderControl('map', 'raulmarcosl.h2di3h3g'));

        var webSocket = new WebSocket("ws://54.213.21.104:9000/onlive");
        webSocket.onmessage = function (event) {

            var tweet = JSON.parse(event.data);
            $("#tweets-feed").append('<p>' + tweet.text + '</p>');

            var marker = L.mapbox.marker.style({
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-77, 37.9]
                },
                properties: {
                    'marker-color': "#333",
                    'marker-symbol': "post",
                }
            }, [tweet.latitude, tweet.longitude]);

            var popupContent =
                '<div class="popup">' +
                    '<div class="tweet">' +
                        '<p>' + tweet.text + '</p>' +
                    '</div>' +
                '</div>';

            marker.bindPopup(popupContent, {
                closeButton: true,
                minWidth: 100
            });

            marker.addTo(window.supermap);
        }
    </script>
</body>
</html>

